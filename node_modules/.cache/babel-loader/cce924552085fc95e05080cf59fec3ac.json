{"ast":null,"code":"\"use strict\";\n\nvar _regeneratorRuntime = require(\"@babel/runtime/regenerator\");\n\nvar _asyncToGenerator = require(\"@babel/runtime/helpers/asyncToGenerator\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.clientRender = void 0;\n\nvar ssr_client_utils_1 = require(\"ssr-client-utils\"); // @ts-expect-error\n\n\nvar Routes = require(\"_build/ssr-temporary-routes\");\n\nvar create_1 = require(\"./create\");\n\nvar FeRoutes = Routes.FeRoutes,\n    App = Routes.App,\n    layoutFetch = Routes.layoutFetch,\n    PrefixRouterBase = Routes.PrefixRouterBase;\nvar hasRender = false;\n\nfunction getAsyncCombineData(_x, _x2, _x3) {\n  return _getAsyncCombineData.apply(this, arguments);\n}\n\nfunction _getAsyncCombineData() {\n  _getAsyncCombineData = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(fetch, store, router) {\n    var layoutFetchData, fetchData, fetchFn;\n    return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            layoutFetchData = {};\n            fetchData = {};\n\n            if (!layoutFetch) {\n              _context3.next = 6;\n              break;\n            }\n\n            _context3.next = 5;\n            return layoutFetch({\n              store: store,\n              router: router\n            });\n\n          case 5:\n            layoutFetchData = _context3.sent;\n\n          case 6:\n            if (!fetch) {\n              _context3.next = 13;\n              break;\n            }\n\n            _context3.next = 9;\n            return fetch();\n\n          case 9:\n            fetchFn = _context3.sent;\n            _context3.next = 12;\n            return fetchFn[\"default\"]({\n              store: store,\n              router: router\n            });\n\n          case 12:\n            fetchData = _context3.sent;\n\n          case 13:\n            return _context3.abrupt(\"return\", Object.assign({}, layoutFetchData !== null && layoutFetchData !== void 0 ? layoutFetchData : {}, fetchData !== null && fetchData !== void 0 ? fetchData : {}));\n\n          case 14:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3);\n  }));\n  return _getAsyncCombineData.apply(this, arguments);\n}\n\nvar clientRender = /*#__PURE__*/function () {\n  var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n    var _a, _b, _c, _d, store, router, fetchData, app;\n\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            store = (0, create_1.createStore)();\n            router = (0, create_1.createRouter)({\n              base: (_a = window.prefix) !== null && _a !== void 0 ? _a : PrefixRouterBase\n            });\n\n            if (window.__INITIAL_DATA__) {\n              store.replaceState(window.__INITIAL_DATA__);\n            }\n\n            fetchData = (_b = window.__INITIAL_DATA__) !== null && _b !== void 0 ? _b : {};\n            app = new create_1.RealVue({\n              // 根实例简单的渲染应用程序组件。\n              render: function render(h) {\n                return h(App, {\n                  props: {\n                    fetchData: fetchData\n                  }\n                });\n              },\n              store: store,\n              router: router\n            });\n            router.beforeResolve( /*#__PURE__*/function () {\n              var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(to, from, next) {\n                var _a, route, fetch, combineAysncData;\n\n                return _regeneratorRuntime.wrap(function _callee$(_context) {\n                  while (1) {\n                    switch (_context.prev = _context.next) {\n                      case 0:\n                        if (!(hasRender || !window.__USE_SSR__)) {\n                          _context.next = 7;\n                          break;\n                        }\n\n                        route = (0, ssr_client_utils_1.findRoute)(FeRoutes, to.path);\n                        fetch = route.fetch;\n                        _context.next = 5;\n                        return getAsyncCombineData(fetch, store, to);\n\n                      case 5:\n                        combineAysncData = _context.sent;\n                        (_a = to.matched) === null || _a === void 0 ? void 0 : _a.forEach(function (item) {\n                          var _a;\n\n                          item.props = Object.assign({}, (_a = item.props) !== null && _a !== void 0 ? _a : {}, {\n                            fetchData: combineAysncData\n                          });\n                        });\n\n                      case 7:\n                        hasRender = true;\n                        next();\n\n                      case 9:\n                      case \"end\":\n                        return _context.stop();\n                    }\n                  }\n                }, _callee);\n              }));\n\n              return function (_x4, _x5, _x6) {\n                return _ref2.apply(this, arguments);\n              };\n            }());\n            router.onReady(function () {\n              app.$mount('#app', !!window.__USE_SSR__); // 这里需要做判断 ssr/csr 来为 true/false\n            });\n\n            if (!window.__USE_VITE__) {\n              (_d = (_c = module === null || module === void 0 ? void 0 : module.hot) === null || _c === void 0 ? void 0 : _c.accept) === null || _d === void 0 ? void 0 : _d.call(_c); // webpack 场景下的 hmr\n            }\n\n          case 8:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  }));\n\n  return function clientRender() {\n    return _ref.apply(this, arguments);\n  };\n}();\n\nexports.clientRender = clientRender;\n\nif (!window.__disableClientRender__) {\n  // 如果服务端直出的时候带上该记号，则默认不进行客户端渲染，将处理逻辑交给上层\n  // 可用于微前端场景下自定义什么时候进行组件渲染的逻辑调用\n  clientRender();\n}","map":{"version":3,"sources":["/Users/yumengcheng/Study/nine-ssr/node_modules/ssr-plugin-vue/cjs/entry/client-entry.js"],"names":["Object","defineProperty","exports","value","clientRender","ssr_client_utils_1","require","Routes","create_1","FeRoutes","App","layoutFetch","PrefixRouterBase","hasRender","getAsyncCombineData","fetch","store","router","layoutFetchData","fetchData","fetchFn","assign","createStore","createRouter","base","_a","window","prefix","__INITIAL_DATA__","replaceState","_b","app","RealVue","render","h","props","beforeResolve","to","from","next","__USE_SSR__","route","findRoute","path","combineAysncData","matched","forEach","item","onReady","$mount","__USE_VITE__","_d","_c","module","hot","accept","call","__disableClientRender__"],"mappings":"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","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.clientRender = void 0;\nconst ssr_client_utils_1 = require(\"ssr-client-utils\");\n// @ts-expect-error\nconst Routes = require(\"_build/ssr-temporary-routes\");\nconst create_1 = require(\"./create\");\nconst { FeRoutes, App, layoutFetch, PrefixRouterBase } = Routes;\nlet hasRender = false;\nasync function getAsyncCombineData(fetch, store, router) {\n    let layoutFetchData = {};\n    let fetchData = {};\n    if (layoutFetch) {\n        layoutFetchData = await layoutFetch({ store, router });\n    }\n    if (fetch) {\n        const fetchFn = await fetch();\n        fetchData = await fetchFn.default({ store, router });\n    }\n    return Object.assign({}, layoutFetchData !== null && layoutFetchData !== void 0 ? layoutFetchData : {}, fetchData !== null && fetchData !== void 0 ? fetchData : {});\n}\nconst clientRender = async () => {\n    var _a, _b, _c, _d;\n    const store = (0, create_1.createStore)();\n    const router = (0, create_1.createRouter)({\n        base: (_a = window.prefix) !== null && _a !== void 0 ? _a : PrefixRouterBase\n    });\n    if (window.__INITIAL_DATA__) {\n        store.replaceState(window.__INITIAL_DATA__);\n    }\n    const fetchData = (_b = window.__INITIAL_DATA__) !== null && _b !== void 0 ? _b : {};\n    const app = new create_1.RealVue({\n        // 根实例简单的渲染应用程序组件。\n        render: h => h(App, {\n            props: {\n                fetchData\n            }\n        }),\n        store,\n        router\n    });\n    router.beforeResolve(async (to, from, next) => {\n        var _a;\n        // 找到要进入的组件并提前执行 fetch 函数\n        if (hasRender || !window.__USE_SSR__) {\n            const route = (0, ssr_client_utils_1.findRoute)(FeRoutes, to.path);\n            const { fetch } = route;\n            const combineAysncData = await getAsyncCombineData(fetch, store, to);\n            (_a = to.matched) === null || _a === void 0 ? void 0 : _a.forEach(item => {\n                var _a;\n                item.props = Object.assign({}, (_a = item.props) !== null && _a !== void 0 ? _a : {}, {\n                    fetchData: combineAysncData\n                });\n            });\n        }\n        hasRender = true;\n        next();\n    });\n    router.onReady(() => {\n        app.$mount('#app', !!window.__USE_SSR__); // 这里需要做判断 ssr/csr 来为 true/false\n    });\n    if (!window.__USE_VITE__) {\n        (_d = (_c = module === null || module === void 0 ? void 0 : module.hot) === null || _c === void 0 ? void 0 : _c.accept) === null || _d === void 0 ? void 0 : _d.call(_c); // webpack 场景下的 hmr\n    }\n};\nexports.clientRender = clientRender;\nif (!window.__disableClientRender__) {\n    // 如果服务端直出的时候带上该记号，则默认不进行客户端渲染，将处理逻辑交给上层\n    // 可用于微前端场景下自定义什么时候进行组件渲染的逻辑调用\n    clientRender();\n}\n"]},"metadata":{},"sourceType":"script"}